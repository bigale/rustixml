FROM rust:1.83-slim

WORKDIR /app

# Copy project files
COPY Cargo.toml Cargo.lock ./
COPY src ./src

# Copy test files to container
COPY ixml_tests /ixml_tests

# Build release binary
RUN cargo build --release --bin safe_conformance_runner

# Set environment
ENV RUST_BACKTRACE=0
ENV TERM=dumb

# Run tests and output results to stdout (sanitized)
CMD ["cargo", "run", "--release", "--bin", "safe_conformance_runner"]
